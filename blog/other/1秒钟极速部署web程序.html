<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1秒钟，极速部署web程序！ | Zachary&#39;s Blog</title>
    <meta name="description" content="Nothing&#39;s gonna change my love">
    
    
    <link rel="preload" href="/assets/css/0.styles.fbb248c1.css" as="style"><link rel="preload" href="/assets/js/app.9df4e30f.js" as="script"><link rel="preload" href="/assets/js/3.4685d3aa.js" as="script"><link rel="preload" href="/assets/js/2.c52e775b.js" as="script"><link rel="preload" href="/assets/js/11.2f24c71b.js" as="script"><link rel="prefetch" href="/assets/js/10.b1ebbbe0.js"><link rel="prefetch" href="/assets/js/12.74cf421f.js"><link rel="prefetch" href="/assets/js/13.2e2ba9a4.js"><link rel="prefetch" href="/assets/js/14.2728cf46.js"><link rel="prefetch" href="/assets/js/15.8ee8c452.js"><link rel="prefetch" href="/assets/js/16.ceae9725.js"><link rel="prefetch" href="/assets/js/17.26331a0d.js"><link rel="prefetch" href="/assets/js/4.aef7c8b3.js"><link rel="prefetch" href="/assets/js/5.127604fa.js"><link rel="prefetch" href="/assets/js/6.a0a2722d.js"><link rel="prefetch" href="/assets/js/7.f7888d57.js"><link rel="prefetch" href="/assets/js/8.3e000ec4.js"><link rel="prefetch" href="/assets/js/9.15f0deb0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fbb248c1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Zachary's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Category</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/android/" class="nav-link">Android</a></li><li class="dropdown-item"><!----> <a href="/blog/flutter/" class="nav-link">Flutter</a></li><li class="dropdown-item"><!----> <a href="/blog/backend/" class="nav-link">Backend</a></li><li class="dropdown-item"><!----> <a href="/blog/other/" class="nav-link router-link-active">Other</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/zcoderr" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Category</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/android/" class="nav-link">Android</a></li><li class="dropdown-item"><!----> <a href="/blog/flutter/" class="nav-link">Flutter</a></li><li class="dropdown-item"><!----> <a href="/blog/backend/" class="nav-link">Backend</a></li><li class="dropdown-item"><!----> <a href="/blog/other/" class="nav-link router-link-active">Other</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/zcoderr" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <!----> </div> <!----> <div class="content default"><h1 id="_1秒钟，极速部署web程序！"><a href="#_1秒钟，极速部署web程序！" aria-hidden="true" class="header-anchor">#</a> 1秒钟，极速部署web程序！</h1> <p>在开发过程中，修改完代码后部署到服务器是一件头疼的事，每一次部署都要上传代码，重启程序，这个过程最少也需要3分钟的时间，作为程序员，怎么能把时间浪费在这种重复操作上呢，我们可以通过一些现有工具的配合，实现码的自动部署，这篇文章的最终实现效果是将本地中修改完的nodejs代码一键运行在服务器端，其它语言同理，只是使用到的工具会有所不同。**</p> <h3 id="一、准备工作：安装node-js和git"><a href="#一、准备工作：安装node-js和git" aria-hidden="true" class="header-anchor">#</a> 一、准备工作：安装node.js和git</h3> <p>我更喜欢用nvm来管理nodejs的版本，nvm需要高版本git支持，而centos yum源里的git版本太低，所以我们要先编译安装新版本的git，关于如何安装，可以看下面这篇文章：</p> <p>安装新版本git： https://segmentfault.com/a/1190000007134786</p> <h5 id="_1-安装nvm"><a href="#_1-安装nvm" aria-hidden="true" class="header-anchor">#</a> 1.安装nvm</h5> <div class="language-shell extra-class"><pre class="language-text"><code>yum install curl-devel   #确保curl-devel已经安装
curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.29.0/install.sh | bash
#执行完后退出终端重新进入
nvm --version #可以看到nvm版本
</code></pre></div><p>如果执行curl安装nvm的过程中出现如下错误：fatal: Unable to find remote helper for 'https'，是因为系统找不到git-remote-https，修改下PATH就好了。</p> <h5 id="_2-修改path："><a href="#_2-修改path：" aria-hidden="true" class="header-anchor">#</a> 2.修改PATH：</h5> <div class="language-shell extra-class"><pre class="language-text"><code>vi ~/.bash_profile
    PATH=$PATH:/usr/libexec/git-core  #在PATH里添加这一行
source ~/.bash_profile
</code></pre></div><h5 id="_3-使用nvm安装指定版本nodejs"><a href="#_3-使用nvm安装指定版本nodejs" aria-hidden="true" class="header-anchor">#</a> 3.使用nvm安装指定版本nodejs</h5> <div class="language-shell extra-class"><pre class="language-text"><code>nvm ls-remote #查看可安装版本
nvm install v6.2.0 #安装一个较为稳定的版本
nvm ls  #查看已经安装的版本
nvm use v4.6.0 #切换版本
nvm alias default v6.2.0 #设置默认版本
node --version  
</code></pre></div><h3 id="二、使用git自动部署代码"><a href="#二、使用git自动部署代码" aria-hidden="true" class="header-anchor">#</a> 二、使用git自动部署代码</h3> <p>接下来我们使用最为优秀的版本控制工具git来同步我在本地和服务器上的代码。</p> <p><em>先梳理一下大致流程：</em></p> <ul><li>首先在服务器端创建一个文件夹，使用初始化指令使其成为git的中心仓库。</li> <li>然后在本地电脑新建的项目文件夹中clong上一步在服务器中建立的中心仓库。</li> <li>在服务器中新建一个要部署代码的目录，并clone中心仓库。</li> <li>修改服务器中心仓库中的hook文件，实现本地电脑push代码后，自动部署到上一步建立的代码目录。</li></ul> <p><em>下面是每一步的具体操作：</em></p> <h5 id="_1、在服务器中初始化git中心仓库"><a href="#_1、在服务器中初始化git中心仓库" aria-hidden="true" class="header-anchor">#</a> 1、在服务器中初始化git中心仓库</h5> <div class="language-shell extra-class"><pre class="language-text"><code>mkdir /gitRepo  #新建一个文件夹作为仓库
cd /gitRepo
git init --bare project.git #初始化一个名为progect的仓库
cd project.git #可以看到新仓库中的各个文件
</code></pre></div><p>执行完以上步骤，会在 /gitRepo 文件夹中创建一个名为project的裸库，这个仓库就是之后在客户端的目标仓库</p> <h5 id="_2、在本地电脑克隆远程仓库"><a href="#_2、在本地电脑克隆远程仓库" aria-hidden="true" class="header-anchor">#</a> 2、在本地电脑克隆远程仓库</h5> <p>要在本地连接到仓库首先需要将本地机器的公钥复制给服务器</p> <div class="language-shell extra-class"><pre class="language-text"><code>ssh-keygen -t rsa  #如果本地还没有生成公钥和秘钥，使用此命令生成
cat  .ssh/id_rsa.pub #查看生成的公钥，将此公钥复制到服务器的 ~/.ssh/authorized_keys 文件末尾
git clone 用户名@服务器地址:/gitRepo/project.git #在当前目录克隆仓库
</code></pre></div><h5 id="_3、在服务器中配置代码自动部署"><a href="#_3、在服务器中配置代码自动部署" aria-hidden="true" class="header-anchor">#</a> 3、在服务器中配置代码自动部署</h5> <div class="language-shell extra-class"><pre class="language-text"><code>git clong /gitRepo/project.git #在要部署代码的文件夹里克隆仓库
cp post-receive-sample post-receive #拷贝一份示例文件为post-receive
vi post-receive
# 在文件中加入以下指令
    #!/bin/sh
    unset GIT_DIR
    cd 项目路径  #就是进入刚才做克隆操作时的文件夹
    git pull   #执行拉取指令
chmod 775 post-receive  #最后一定要将此文件的权限改为可执行
</code></pre></div><p>执行完所有步骤之后，每次在本地电脑中提交代码到中心仓库，git便会自动将最新的代码pull到服务器中的代码目录。</p> <h5 id="附：git常用命令"><a href="#附：git常用命令" aria-hidden="true" class="header-anchor">#</a> 附：git常用命令</h5> <div class="language-shell extra-class"><pre class="language-text"><code>git add . #添加所有文件到git索引
git commit -m &quot;&quot;  #提交索引到的文件到缓冲区
git push origin master #客户端第一次提交时需要使用此命令提交到远程master分支
git push        #提交缓冲区中的文件
git rm &lt;filename&gt;  #在git索引中移除文件
git rm -r .   #在索引中移除所有文件
</code></pre></div><h3 id="三、node程序自动运行"><a href="#三、node程序自动运行" aria-hidden="true" class="header-anchor">#</a> 三、node程序自动运行</h3> <p>现在通过git提交的代码可以自动部署到服务器的代码目录了，接下来通过使用pm2，在代码变更后让程序自动重启。</p> <div class="language-shell extra-class"><pre class="language-text"><code>npm install -g pm2  #服务器中全局安装pm2
pm2 start helloworld.js  #使用pm2启动nodejs程序
</code></pre></div><h3 id="四、编写push脚本，一键将本地程序运行在服务器"><a href="#四、编写push脚本，一键将本地程序运行在服务器" aria-hidden="true" class="header-anchor">#</a> 四、编写push脚本，一键将本地程序运行在服务器</h3> <p>现在每次使用git提交代码后，服务器会自动部署代码并重启程序，已经不需要我们再对服务器做任何操作了，是不是已经简化了百分之七十的工作量了？但是我们的目标不仅于此，毕竟每次push还需要三条指令呢，作为新时代的程序员，能让电脑做的决不自己去做。所以我们要通过一个脚本，在每次更改完代码之后一键把本地的代码运行在服务器上。</p> <div class="language-shell extra-class"><pre class="language-text"><code># 以下为shell脚本，在mac上可以原生执行，使用Windows的同学可以自行搜索bat脚本写法，类推一下。
touch push.sh  #在本地的代码目录新建一个脚本文件。
chmod +x push.sh #设置脚本权限为可执行
vim push.sh  #打开脚本，并写入以下命令
    git add ./
    read commitMessage  
    git commit -m commitMessage  
    git push
    echo Wow！ 代码一键部署完成！

</code></pre></div><p>** 最后，激动人心的时刻到了，以后每次修改完代码，执行这个命令：<code>./push.sh</code>，然后输入提交信息，好了，你的代码已经在服务器上飞起来了！**</p></div> <div class="home"><div class="footer">
    MIT Licensed | Copyright © 2018-present Evan You
  </div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9df4e30f.js" defer></script><script src="/assets/js/3.4685d3aa.js" defer></script><script src="/assets/js/2.c52e775b.js" defer></script><script src="/assets/js/11.2f24c71b.js" defer></script>
  </body>
</html>
